import pandas as pd
import json
import os

def read_intermediate_output(dag_id: str, task_id: str, run_id: str, suffix: str = "parquet", as_pandas: bool = True):
    """
    Reads intermediate output files (Parquet or JSON) for a given DAG and task.

    Parameters:
        dag_id (str): The DAG identifier.
        task_id (str): The task ID within the DAG.
        run_id (str): The unique identifier for a specific run.
        suffix (str): File format, e.g., 'parquet', 'json'.
        as_pandas (bool): Whether to return the data as a pandas DataFrame (only applicable to parquet or JSON records).

    Returns:
        pd.DataFrame or dict or list: Loaded data depending on the file format and `as_pandas`.
    """
    base_path = f"/path/to/intermediate/outputs/{dag_id}/{task_id}/{run_id}.{suffix}"

    if suffix == "parquet":
        if as_pandas:
            return pd.read_parquet(base_path)
        else:
            raise ValueError("Parquet files can only be returned as pandas DataFrames.")
    
    elif suffix == "json":
        with open(base_path, 'r') as f:
            data = json.load(f)
            if as_pandas:
                return pd.DataFrame(data) if isinstance(data, list) else pd.json_normalize(data)
            return data

    else:
        raise ValueError(f"Unsupported suffix: {suffix}")

