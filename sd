from sklearn.preprocessing import LabelEncoder

def preprocess_for_lightgbm(df):
    """
    Converts all object and category columns to numeric using Label Encoding,
    and converts datetime columns to timestamp integers.
    """
    label_encoders = {}

    for col in df.columns:
        if df[col].dtype == 'object' or str(df[col].dtype) == 'category':
            le = LabelEncoder()
            df[col] = df[col].astype(str).fillna("missing")
            df[col] = le.fit_transform(df[col])
            label_encoders[col] = le

        elif np.issubdtype(df[col].dtype, np.datetime64):
            df[col] = df[col].view('int64')  # Convert datetime to Unix timestamp

    return df, label_encoders
